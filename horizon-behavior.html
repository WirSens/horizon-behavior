<link rel="import" href="../polymer/polymer.html">

<script>
    WIRSENS = window.WIRSENS || {};

    /* @polymerBehavior */
    WIRSENS.HorizonBehavior = {
        
        properties: {
            
            _horizonHost: String,
            _horizonPort: String,

            _horizon: {
                type: Object,
                computed: '_computeHorizon(_horizonHost, _horizonPort, _isReady)',
                notify: true
            }
        },

        observers: [
            '_loadLib(_horizonHost, _horizonPort)'
        ],

        ready: function () {

            var config = new Polymer.IronMetaQuery().byKey('horizon-config');

            this._horizonHost = !!config ? config.host : 'localhost';
            this._horizonPort = !!config ? config.port : '8181';
        },

        _loadLib: function (host, port) {
            var script = document.createElement('script');
            script.src = 'http://' + host + ':' + port + '/horizon/horizon.js';
            Polymer.dom(this.root).appendChild(script);

            script.onload = function () {
                this._isReady = true;
            }.bind(this);
        },

        _computeHorizon: function (host, port) {
            return Horizon({
                host: host + ':' + port
            });
        }  
    };
</script>